<link rel="stylesheet" href="~/css/jkanban.min.css">
<style>
    .m-b-30 {
        margin-bottom: 60px;
    }
    
    .success {
        background: #00B961;
        color: #fff;
    }
    
    .notstart {
        background: #8a8a8a;
        color: #fff;
    }
    
    .info {
        background: #2A92BF;
        color: #fff;
    }
    
    .warning {
        background: #F4CE46;
        color: #fff;
    }
    
    .error {
        background: #FB7D44;
        color: #fff;
    }
    
    #demo3 {
        overflow-x: auto;
        padding: 20px 0;
    }
</style>
<section id="main-content">
    <section class="wrapper">
        <!--overview start-->
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="fa fa-laptop"></i> Projeler</h3>
                <ol class="breadcrumb">
                    <li><i class="fa fa-home"></i><a href="index.html">Anasayfa</a></li>
                    <li><i class="fa fa-laptop"></i>Projeler</li>
                </ol>
            </div>
        </div>
        <div class="btn-group-toggle">
        </div>
        <section class="panel">

            <div class="panel-heading">
                <button class="btn btn-info btn-block" onclick="$('#AddProject').modal('show')" type="button"><span class="icon_plus_alt2"></span> Proje Ekle</button>
            </div>

            <div class="panel-content" style="height: 766px;">
                <center>
                    <div id="projectList">
                    </div>
                </center>
            </div>
        </section>

    </section>
</section>
<div class="modal fade" id="AddProject" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="/Project/Create" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Proje Ekle</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="control-label">Proje Başlığı:</label>
                        <input type="text" class="form-control" name="Title" required>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Açıklama:</label>
                        <input type="text" class="form-control" name="Description" required>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Hedef Zamanı:</label>
                        <input type="date" name="GoalTime" class="form-control" id="GoalTime" required>

                    </div>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Kapat</button>
                    <button class="btn btn-info" type="submit">Ekle</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts{
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="~/js/jkanban.min.js"></script>
<script>
    $('form').on('submit', (e) => {
        e.preventDefault();
        const body = new FormData(e.currentTarget);
        fetch(e.currentTarget.action, {
            method: 'post',
            body
        }).then(res => res.json()).then(res => {
            initData();
            Swal.fire(
                'Oluşturdu!',
                'Projeniz eklendi.',
                'success'
            )
            $('#AddProject').modal('hide');
        });
    })
</script>
<script>
    var kanban;
    $(() => initData());

    function initData() {
        $('#projectList').empty();
        fetch('/Project/ReadToAll')
            .then(res => res.json())
            .then(list => {
                kanban = new jKanban({
                    element: '#projectList',
                    addItemButton: true,
                    widthBoard: '350px',
                    addItemButton: false,
                    click: function(el) {
                        console.log(el);
                        let itemid = $(el).attr('data-eid');
                        window.location = ('/Work/Index?Id=' + itemid)
                    },
                    dragendEl: function(el) {
                        console.log(el);
                        let itemid = $(el).attr('data-eid');
                        let statusid = $(el).parent().parent().attr('data-id').replace('status_', '');
                        fetch('/Project/UpdateStatus?itemId=' + itemid + '&statusid=' + statusid);
                    },
                    boards: [{
                        'id': 'status_0',
                        'title': 'Yapılacaklar',
                        'class': 'notstart',
                        'dragTo': ['status_1'],
                        'item': list.filter(f => f.status == 0).map(item => ({
                            'id': item.id,
                            'title': item.title
                        }))
                    }, {
                        'id': 'status_1',
                        'title': 'Yapılıyor',
                        'class': 'warning',
                        'item': list.filter(f => f.status == 1).map(item => ({
                            'id': item.id,
                            'title': item.title
                        }))
                    }, {
                        'id': 'status_2',
                        'title': 'Testte',
                        'class': 'info',
                        'item': list.filter(f => f.status == 2).map(item => ({
                            'id': item.id,
                            'title': item.title
                        }))
                    }, {
                        'id': 'status_3',
                        'title': 'Bitti',
                        'class': 'success',
                        'item': list.filter(f => f.status == 3).map(item => ({
                            'id': item.id,
                            'title': item.title
                        }))
                    }]
                });
            });
    }
</script>

}